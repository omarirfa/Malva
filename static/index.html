<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malva ‚Ä¢ AI Companion</title>

    <!-- Improved resource loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

    <!-- Preload critical assets -->
    <link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/marked@15.0.7/marked.min.js">
    <link rel="preload" as="style" href="static/styles.css">
    <link rel="preload" as="script" href="static/script.js">

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="static/styles.css">

    <!-- Animated Raindrop Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='dropGradient' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23a855f7'/%3E%3Cstop offset='100%25' stop-color='%2310b981'/%3E%3C/linearGradient%3E%3Cfilter id='glow' x='-20%25' y='-20%25' width='140%25' height='140%25'%3E%3CfeGaussianBlur stdDeviation='2' result='blur'/%3E%3CfeComposite in='SourceGraphic' in2='blur' operator='over'/%3E%3C/filter%3E%3Cstyle%3E@keyframes fall%7B0%25%7Btransform:translateY(-100px)%7D100%25%7Btransform:translateY(200px)%7D%7D@keyframes zoom%7B0%25%7Btransform:scale(1)%7D15%25%7Btransform:scale(1)%7D30%25%7Btransform:scale(4)%7D70%25%7Btransform:scale(4)%7D85%25%7Btransform:scale(1)%7D100%25%7Btransform:scale(1)%7D%7D@keyframes splash%7B0%25,40%25%7Bopacity:0;transform:scale(.2)%7D50%25%7Bopacity:1;transform:scale(1)%7D70%25%7Bopacity:1;transform:scale(1.2)%7D100%25%7Bopacity:0;transform:scale(1.5)%7D%7D@keyframes fadeInOut%7B0%25,30%25,70%25,100%25%7Bopacity:0%7D40%25,60%25%7Bopacity:1%7D%7D@keyframes miniDropsFall%7B0%25%7Btransform:translate(0,0)%7D100%25%7Btransform:translate(var(--tx),var(--ty))%7D%7D.raindrop%7Banimation:fall 2s linear infinite;animation-delay:calc(var(--delay)*-2s);opacity:.7%7D.scene%7Banimation:zoom 8s ease-in-out infinite;transform-origin:50px 50px%7D.splash%7Banimation:splash 8s ease-in-out infinite;transform-origin:50px 55px%7D.main-drop%7Banimation:fadeInOut 8s ease-in-out infinite%7D.mini-drop%7Banimation:miniDropsFall .5s ease-out forwards;animation-delay:4s%7D%3C/style%3E%3C/defs%3E%3Crect width='100' height='100' fill='%23f0f9ff'/%3E%3Cg class='scene'%3E%3Cg class='rain-scene'%3E%3Cpath d='M20,30 Q20,33 18,35 Q16,33 16,30 Q16,28 18,27 Q20,28 20,30 Z' fill='url(%23dropGradient)' class='raindrop' style='--delay: 0.1'/%3E%3Cpath d='M30,20 Q30,23 28,25 Q26,23 26,20 Q26,18 28,17 Q30,18 30,20 Z' fill='url(%23dropGradient)' class='raindrop' style='--delay: 0.3'/%3E%3Cpath d='M40,25 Q40,28 38,30 Q36,28 36,25 Q36,23 38,22 Q40,23 40,25 Z' fill='url(%23dropGradient)' class='raindrop' style='--delay: 0.5'/%3E%3Cpath d='M50,15 Q50,18 48,20 Q46,18 46,15 Q46,13 48,12 Q50,13 50,15 Z' fill='url(%23dropGradient)' class='raindrop' style='--delay: 0.2'/%3E%3Cpath d='M60,30 Q60,33 58,35 Q56,33 56,30 Q56,28 58,27 Q60,28 60,30 Z' fill='url(%23dropGradient)' class='raindrop' style='--delay: 0.6'/%3E%3Cpath d='M70,25 Q70,28 68,30 Q66,28 66,25 Q66,23 68,22 Q70,23 70,25 Z' fill='url(%23dropGradient)' class='raindrop' style='--delay: 0.4'/%3E%3Cpath d='M80,20 Q80,23 78,25 Q76,23 76,20 Q76,18 78,17 Q80,18 80,20 Z' fill='url(%23dropGradient)' class='raindrop' style='--delay: 0.7'/%3E%3C/g%3E%3Cg class='main-drop'%3E%3Cpath d='M55,45 Q55,55 50,60 Q45,55 45,45 Q45,40 50,38 Q55,40 55,45 Z' fill='url(%23dropGradient)' filter='url(%23glow)'/%3E%3C/g%3E%3C/g%3E%3Cg class='splash'%3E%3Ccircle cx='50' cy='55' r='5' fill='url(%23dropGradient)' opacity='0.8'/%3E%3Ccircle cx='50' cy='55' r='2' fill='url(%23dropGradient)' class='mini-drop' style='--tx: -8px; --ty: -10px'/%3E%3Ccircle cx='50' cy='55' r='1.5' fill='url(%23dropGradient)' class='mini-drop' style='--tx: 7px; --ty: -8px'/%3E%3Ccircle cx='50' cy='55' r='2' fill='url(%23dropGradient)' class='mini-drop' style='--tx: 10px; --ty: 5px'/%3E%3Ccircle cx='50' cy='55' r='1.8' fill='url(%23dropGradient)' class='mini-drop' style='--tx: -9px; --ty: 7px'/%3E%3Ccircle cx='50' cy='55' r='1.3' fill='url(%23dropGradient)' class='mini-drop' style='--tx: 0px; --ty: -12px'/%3E%3Ccircle cx='50' cy='55' r='1.2' fill='url(%23dropGradient)' class='mini-drop' style='--tx: -5px; --ty: 10px'/%3E%3Ccircle cx='50' cy='55' r='1' fill='url(%23dropGradient)' class='mini-drop' style='--tx: 6px; --ty: 9px'/%3E%3C/g%3E%3C/svg%3E">

    <!-- Marked.js for markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@15.0.7/marked.min.js" defer></script>
</head>
<body data-theme="light">
    <!-- Sidebar Trigger Area -->
    <div class="sidebar-trigger" id="sidebar-trigger"></div>
    <div class="sidebar-indicator" id="sidebar-indicator"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">M</div>
                    <span>Malva</span>
                </div>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Appearance Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    Appearance
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">Theme</div>
                    <button id="theme-toggle" class="action-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">High Contrast</div>
                    <label class="switch">
                        <input type="checkbox" id="toggle-contrast">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">Font Size</div>
                    <div class="flex gap-2">
                        <button id="decrease-font" class="action-button" aria-label="Decrease font size">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="8" y1="12" x2="16" y2="12"></line>
                            </svg>
                        </button>
                        <button id="increase-font" class="action-button" aria-label="Increase font size">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="16"></line>
                                <line x1="8" y1="12" x2="16" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Model Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="16 18 22 12 16 6"></polyline>
                        <polyline points="8 6 2 12 8 18"></polyline>
                    </svg>
                    Model
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">Select Model</div>
                    <select id="model-select" class="action-button" aria-label="Select AI model">
                        <option value="gemma3:4b" selected>Gemma 3 (4B)</option>
                        <option value="gemma3:12b">Gemma 3 (12B)</option>
                        <option value="gemma3:27b">Gemma 3 (27B)</option>
                    </select>
                </div>
            </div>

            <!-- Voice Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                    Voice
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">TTS Enabled</div>
                    <label class="switch">
                        <input type="checkbox" id="tts-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">Language</div>
                    <select id="language-select" class="action-button" aria-label="Select TTS language">
                        <option value="a" selected>üá∫üá∏ American English</option>
                        <option value="b">üá¨üáß British English</option>
                        <option value="j">üáØüáµ Japanese</option>
                        <option value="z">üá®üá≥ Mandarin Chinese</option>
                        <option value="e">üá™üá∏ Spanish</option>
                        <option value="f">üá´üá∑ French</option>
                        <option value="h">üáÆüá≥ Hindi</option>
                        <option value="i">üáÆüáπ Italian</option>
                        <option value="p">üáßüá∑ Brazilian Portuguese</option>
                    </select>
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">Voice</div>
                    <select id="voice-select" class="action-button" aria-label="Select TTS voice">
                        <option value="af_heart" selected>üë© Heart (A) ‚ù§Ô∏è</option>
                        <option value="af_bella">üë© Bella (A-) üî•</option>
                        <option value="af_nicole">üë© Nicole (B-) üéß</option>
                        <option value="af_aoede">üë© Aoede (C+)</option>
                        <option value="af_kore">üë© Kore (C+)</option>
                        <option value="af_sarah">üë© Sarah (C+)</option>
                        <option value="am_fenrir">üë® Fenrir (C+)</option>
                        <option value="am_michael">üë® Michael (C+)</option>
                        <option value="am_puck">üë® Puck (C+)</option>
                    </select>
                </div>
            </div>

            <!-- About Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    About
                </div>
                <div class="sidebar-option">
                    <div class="sidebar-option-label">Version</div>
                    <span>1.0.0</span>
                </div>
                <div class="sidebar-option" id="easter-egg-trigger">
                    <div class="sidebar-option-label">Made with ‚ù§Ô∏è</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Container -->
    <main class="main-container" id="main-container">
        <!-- Chat Title -->
        <div class="chat-title" id="chat-title">Malva Chat</div>

        <!-- Chat container -->
        <div class="chat-container">
            <div class="messages-container" id="messages-container">
                <div class="message assistant-message">
                    <div class="message-avatar">M</div>
                    <div class="message-content">
                        <div class="markdown">
                            <p>Hello! I'm Malva, your accessible AI companion. I can understand text, voice, and images. How can I help you today?</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input area -->
        <div class="input-container">
            <div class="input-wrapper">
                <textarea
                    id="user-input"
                    class="input-textarea"
                    placeholder="Type your message here... (Press Enter to send)"
                    aria-label="Type your message"
                    rows="2"
                ></textarea>
                <div class="input-actions">
                    <button id="mic-btn" class="action-button" aria-label="Record voice message">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                    <button id="image-btn" class="action-button" aria-label="Upload image">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </button>
                    <button id="clear-btn" class="action-button" aria-label="Clear conversation">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>
                    <button id="send-btn" class="send-button" aria-label="Send message">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
            </div>

            <input
                type="file"
                id="image-upload"
                accept="image/*"
                aria-label="Upload image"
                hidden
            >

            <div id="image-preview-container" style="display: none; position: relative; margin-top: 0.75rem;">
                <img
                    id="image-preview"
                    alt="Preview of uploaded image"
                    aria-live="polite"
                    style="max-width: 100%; max-height: 200px; border-radius: 0.5rem; border: 1px solid var(--border-color);"
                >
            </div>
        </div>
    </main>

    <!-- Screen reader announcements -->
    <div role="status" aria-live="assertive" id="sr-announcer" class="sr-only"></div>

    <!-- Defer non-critical script loading -->
    <script src="static/script.js" defer></script>
</body>
</html>
